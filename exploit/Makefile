EXPLOIT_INCLUDES := $(shell find ./include -type f -name "*.h")

CFLAGS = -I ../linux-4.1.10/arch/arm/include

PWD := $(CURDIR)

OBJS := src/exploit/exploit.o

CC := gcc

exploit: $(shell find ./src/exploit -type f -name "*.c") $(EXPLOIT_INCLUDES) Makefile
	arm .. make -C exploit build_exploit

%.o: %.c
	$(CC) -fPIE -c $< -o $@ -I include -I headers $(CFLAGS)

build_exploit: $(OBJS)
	$(CC) -static $^ -o exploit -O3