EXPLOIT_INCLUDES := $(shell find ./include -type f -name "*.h")

CFLAGS = -I ../tizen-linux-4.1.10/arch/arm/include

PWD := $(CURDIR)

OBJS := src/exploit/insert.o src/exploit/clone.o src/exploit/exploit.o

# CC := gcc
CC := clang

exploit: $(shell find ./src/exploit -type f -name "*.c") $(EXPLOIT_INCLUDES) Makefile
	arm .. make -C exploit build_exploit

%.o: %.c
	$(CC) -fPIE -c $< -o $@ -I include -I headers $(CFLAGS) -g

%.o: %.s
	$(CC) -fPIE -c $< -o $@

build_exploit: $(OBJS)
	$(CC) -static-pie $^ -o exploit -lpthread